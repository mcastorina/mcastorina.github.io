<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Format Strings | miccah.io</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Format Strings" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The printf family of functions accept a format string as an argument which may be used for formatting the list of arguments passed to the function." />
<meta property="og:description" content="The printf family of functions accept a format string as an argument which may be used for formatting the list of arguments passed to the function." />
<link rel="canonical" href="/knowledge/format-strings.html" />
<meta property="og:url" content="/knowledge/format-strings.html" />
<meta property="og:site_name" content="miccah.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-11-01T16:30:21+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Format Strings" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-01T16:30:21+00:00","datePublished":"2024-11-01T16:30:21+00:00","description":"The printf family of functions accept a format string as an argument which may be used for formatting the list of arguments passed to the function.","headline":"Format Strings","mainEntityOfPage":{"@type":"WebPage","@id":"/knowledge/format-strings.html"},"url":"/knowledge/format-strings.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="miccah.io" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">miccah.io</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/knowledge/">Knowledge Base</a><a class="page-link" href="/posts/">Posts</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Format Strings</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-11-01T16:30:21+00:00" itemprop="datePublished">Nov 1, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>The <code class="language-plaintext highlighter-rouge">printf</code> family of functions accept a format string as an argument
which may be used for formatting the list of arguments passed to the
function.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="kr">restrict</span> <span class="n">format</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div></div>

<p>It is unsafe to use user-supplied input as the format string because
there is a directive (more below) that can write an integer to a memory
location. Further, the format string can expose any data that is on the
stack.</p>

<p>Reference: <code class="language-plaintext highlighter-rouge">man 3 printf</code></p>

<h2 id="specification">Specification</h2>
<p>The overall syntax of a conversion specification is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%[$][flags][width][.precision][length modifier]conversion
</code></pre></div></div>

<h3 id="positional-argument">Positional argument</h3>
<p>Represented as <code class="language-plaintext highlighter-rouge">$</code> above, this option represents the nth argument passed
to <code class="language-plaintext highlighter-rouge">printf</code> (1-indexed).</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">printf</span><span class="p">(</span><span class="s">"%2$d %1$d"</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1">// Output: 20 10</span>
</code></pre></div></div>

<h3 id="flags">Flags</h3>

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0</code></td>
      <td>Zero pad the value</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-</code></td>
      <td>Left adjust to the field boundary</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;space&gt;</code></td>
      <td>A blank should be left before a positive number</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">+</code></td>
      <td>Always use a sign (+/-) before a number</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">'</code></td>
      <td>Group output with thousands’ grouping characters (if locale information has any)</td>
    </tr>
  </tbody>
</table>

<h3 id="width">Width</h3>
<p>Specifying a minimum field width will pad with spaces (by default) on
either the left or right of the value. Instead of a decimal digit, a
<code class="language-plaintext highlighter-rouge">*</code> or <code class="language-plaintext highlighter-rouge">*m$</code> will specify that the field width is given in the next or
<code class="language-plaintext highlighter-rouge">m</code>th argument respectively.</p>

<h3 id="precision">Precision</h3>
<p>Precision represents the minimum number of decimal digits to display
for floating point numbers. Similar to width, <code class="language-plaintext highlighter-rouge">*</code> or <code class="language-plaintext highlighter-rouge">*m$</code> may be used
to indicate the precision is given in an argument.</p>

<h3 id="length-modifier">Length modifier</h3>

<table>
  <thead>
    <tr>
      <th>Modifier</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">hh</code></td>
      <td><code class="language-plaintext highlighter-rouge">char</code> / <code class="language-plaintext highlighter-rouge">unsigned char</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">h</code></td>
      <td><code class="language-plaintext highlighter-rouge">short</code> / <code class="language-plaintext highlighter-rouge">unsigned short</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">l</code></td>
      <td><code class="language-plaintext highlighter-rouge">long</code> / <code class="language-plaintext highlighter-rouge">unsigned long</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ll</code></td>
      <td><code class="language-plaintext highlighter-rouge">long long</code> / <code class="language-plaintext highlighter-rouge">unsigned long long</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">q</code></td>
      <td>synonymous to <code class="language-plaintext highlighter-rouge">ll</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">L</code></td>
      <td><code class="language-plaintext highlighter-rouge">long double</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">j</code></td>
      <td><code class="language-plaintext highlighter-rouge">intmax_t</code> / <code class="language-plaintext highlighter-rouge">uintmax_t</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">z</code></td>
      <td><code class="language-plaintext highlighter-rouge">size_t</code> / <code class="language-plaintext highlighter-rouge">ssize_t</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">t</code></td>
      <td><code class="language-plaintext highlighter-rouge">ptrdiff_t</code></td>
    </tr>
  </tbody>
</table>

<h3 id="conversion-specifier">Conversion specifier</h3>
<p>The type of conversion to apply to the argument.</p>

<table>
  <thead>
    <tr>
      <th>Specifier</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">d</code>, <code class="language-plaintext highlighter-rouge">i</code></td>
      <td>signed decimal notation</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">o</code></td>
      <td>unsigned octal notation</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">u</code></td>
      <td>unsigned decimal notation</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">X</code></td>
      <td>unsigned hexadecimal notation (lower / upper cased)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">e</code>, <code class="language-plaintext highlighter-rouge">E</code></td>
      <td>decimal exponent notation <code class="language-plaintext highlighter-rouge">[-]d.ddde±dd</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">f</code>, <code class="language-plaintext highlighter-rouge">F</code></td>
      <td>decimal notation <code class="language-plaintext highlighter-rouge">[-]ddd.ddd</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">g</code>, <code class="language-plaintext highlighter-rouge">G</code></td>
      <td>automatically choose <code class="language-plaintext highlighter-rouge">e</code> or <code class="language-plaintext highlighter-rouge">f</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">a</code>, <code class="language-plaintext highlighter-rouge">A</code></td>
      <td>hexadecimal decimal notation <code class="language-plaintext highlighter-rouge">[-]0xh.hhhhp±d</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">c</code></td>
      <td><code class="language-plaintext highlighter-rouge">char</code> representation</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">s</code></td>
      <td>string representation</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">p</code></td>
      <td>hexadecimal representation of a pointer</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">n</code></td>
      <td>write the number of characters written so far to an argument</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%</code></td>
      <td>literal <code class="language-plaintext highlighter-rouge">%</code></td>
    </tr>
  </tbody>
</table>

<h2 id="danger-of-format-specifiers">Danger of format specifiers</h2>
<p>If you didn’t catch it, <code class="language-plaintext highlighter-rouge">%n</code> will write the number of written characters
so far to a pointer (passed as an argument).</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">num</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"hello%n"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">num</span><span class="p">);</span>
<span class="c1">// num == 5</span>
</code></pre></div></div>

<p>This, combined with the variable argument list <code class="language-plaintext highlighter-rouge">printf</code> uses means an
attacker can overwrite arbitrary bytes in memory (e.g. pointers on the
stack). If the input buffer also exists on the stack, the attacker can
supply the address they want to overwrite as well.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">secret</span> <span class="o">=</span> <span class="mh">0xdeadbeef</span><span class="p">;</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">secret</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%-1337x%6$n"</span><span class="p">);</span>
    <span class="c1">// secret == 1337</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">secret</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">-m32</span> test.c <span class="nt">-o</span> <span class="nb">test</span> <span class="o">&amp;&amp;</span> ./test
</code></pre></div></div>

  </div><a class="u-url" href="/knowledge/format-strings.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">miccah.io</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">miccah.io</li><li><a class="u-email" href="mailto:contact@miccah.io">contact@miccah.io</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/mcastorina"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">mcastorina</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A website for all my creations, thoughts, and projects. This website will serve as a collection of my interests, ideas, and lessons I have learned over time.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
