<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>PIC from NULL: Programming Concepts and Tips | miccah.io</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="PIC from NULL: Programming Concepts and Tips" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This tutorial aims to get beginners started with PIC programming. This is the second post of the cleverly named series PIC from NULL. To understand PIC flashing, please refer to the first post: PIC from NULL: Flashing." />
<meta property="og:description" content="This tutorial aims to get beginners started with PIC programming. This is the second post of the cleverly named series PIC from NULL. To understand PIC flashing, please refer to the first post: PIC from NULL: Flashing." />
<link rel="canonical" href="/posts/pic-from-null-programming-concepts-and-tips.html" />
<meta property="og:url" content="/posts/pic-from-null-programming-concepts-and-tips.html" />
<meta property="og:site_name" content="miccah.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-07T05:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PIC from NULL: Programming Concepts and Tips" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-11-07T05:00:00+00:00","datePublished":"2020-11-07T05:00:00+00:00","description":"This tutorial aims to get beginners started with PIC programming. This is the second post of the cleverly named series PIC from NULL. To understand PIC flashing, please refer to the first post: PIC from NULL: Flashing.","headline":"PIC from NULL: Programming Concepts and Tips","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/pic-from-null-programming-concepts-and-tips.html"},"url":"/posts/pic-from-null-programming-concepts-and-tips.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="miccah.io" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">miccah.io</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/knowledge/">Knowledge Base</a><a class="page-link" href="/posts/">Posts</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">PIC from NULL: Programming Concepts and Tips</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-11-07T05:00:00+00:00" itemprop="datePublished">Nov 7, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>This tutorial aims to get beginners started with PIC programming.
This is the second post of the cleverly named series <strong><em>PIC from NULL</em></strong>.
To understand PIC flashing, please refer to the first post:
<a href="/posts/pic-from-null-flashing.html">PIC from NULL: Flashing</a>.</p>

<p>This post covers some basic C programming concepts and tips in the
context of MPLabX. If you are unaware, MPLabX is the official IDE
(integrated development environment) for programming and debugging PIC
microcontrollers.</p>

<h2 id="concepts">Concepts</h2>
<p>Generally when programming a microcontroller, the datasheet for
said microcontroller is your best friend. No, it’s more than your
best friend. It is your bible. Cometh with questions and thee shall
find answers within. Much like the bible, however, it can be hard to
understand, especially for beginners. The good news is you get better
with experience!</p>

<p>Second, you are programming hardware. You are responsible for managing
the hardware. There is no OS (unless you write one).</p>

<p>Third, C is dumb. It does exactly what you tell it to do, even if that
means to shoot yourself in the foot. Think of C as an easier way to
write assembly.</p>

<p>Fourth, this one is a general software development tip. Write readable
code! Someday, far in the future, you will find this code. You will want
to be able to understand it without the context you have now. This is
especially important for programming microcontrollers because a line like</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TRISAbits</span><span class="p">.</span><span class="n">TRISA2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div>

<p>means nothing to you a year from now. It means nothing to beginners
trying to learn. It’s simply magic. Please distill the magic and write
readable code!</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define OUTPUT 0
#define INPUT  1
</span>
<span class="c1">// configure pin A2 as an output</span>
<span class="n">TRISAbits</span><span class="p">.</span><span class="n">TRISA2</span> <span class="o">=</span> <span class="n">OUTPUT</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="pic-specific-tips">PIC Specific Tips</h2>
<p>Here is some useful information for starting out programming the PIC.</p>

<h3 id="timing-and-delays">Timing and Delays</h3>
<p>The <code class="language-plaintext highlighter-rouge">__delay_ms</code> function can be used to cause a delay in your
program. For this function to work, however, you need to <code class="language-plaintext highlighter-rouge">#define</code> the
<code class="language-plaintext highlighter-rouge">_XTAL_FREQ</code> which basically tells the function how fast the clock is
oscillating. Most PICs, or, at least the one I am using, default to a
4 MHz internal clock.</p>

<p>Note: <code class="language-plaintext highlighter-rouge">_XTAL_FREQ</code> stands for “crystal frequency”</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define _XTAL_FREQ 4000000
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// snip</span>

    <span class="n">__delay_ms</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

    <span class="c1">// snip</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Set the clock frequency using <code class="language-plaintext highlighter-rouge">OSCFRQbits.HFFRQ</code>. This is dependent on
your PIC of course, so check your bible!</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define FREQ_32MHZ 0b110
#define _XTAL_FREQ 32000000
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// set internal oscillator frequency</span>
    <span class="n">OSCFRQbits</span><span class="p">.</span><span class="n">HFFRQ</span> <span class="o">=</span> <span class="n">FREQ_32MHZ</span><span class="p">;</span>

    <span class="c1">// snip</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="gpio">GPIO</h3>
<p>General purpose I/O is configured through memory-mapped registers. This
means we configure a pin by writing a 1 or a 0 to a specific region in memory.
The <code class="language-plaintext highlighter-rouge">TRIS</code> registers are the entrypoints for configuration. <code class="language-plaintext highlighter-rouge">TRIS</code> stands for
“tristate”. It is followed by a letter indicating the register.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define OUTPUT 0
#define INPUT  1
</span>
<span class="c1">// configure pin A2 as an output</span>
<span class="n">TRISAbits</span><span class="p">.</span><span class="n">TRISA2</span> <span class="o">=</span> <span class="n">OUTPUT</span><span class="p">;</span>
</code></pre></div></div>

<p>Analog input requires a bit more setup. Like I mentioned in the concepts
section, you are responsible for managing the hardware, and analog input
requires the analog to digital conversion hardware (ADC). Here is an example
with comments.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#define OUTPUT  0
#define INPUT   1
#define LOW     0
#define HIGH    1

#define VDD_REF     0b00
#define FOSC_DIV_16 0b101
#define RIGHT_JUST  1
#define LEFT_JUST   0
#define CH4         0b000100

int main() {
    // Setup analog input on A4
    TRISAbits.TRISA4 = INPUT;
    ANSELAbits.ANSA4 = HIGH;        // analog select A4
    ADCON1bits.ADPREF = VDD_REF;    // configure positive reference voltage
    ADCON1bits.ADCS = FOSC_DIV_16;  // configure conversion frequency as Fosc / 16
    ADCON1bits.ADFM = RIGHT_JUST;   // right justify the 10-bit result across the two 8-bit registers
    ADCON0bits.ADON = HIGH;         // turn ADC on

    ADCON0bits.CHS = CH4;           // select channel 4
    ADCON0bits.GOnDONE = HIGH;      // start a read
    while (ADCON0bits.GOnDONE);     // wait for the result
    uint16_t result = (ADRESH &lt;&lt; 8) | ADRESL;   // right justified read

    // snip
}
</code></pre></div></div>

<h3 id="watchdog">Watchdog</h3>
<p>The watchdog timer periodically resets the microcontroller. Most of the
time, we do not want this behavior, so to disable it you can use this
<code class="language-plaintext highlighter-rouge">PRAGMA</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Disable the watchdog timer */</span>
<span class="cp">#pragma config WDTE = OFF
</span></code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>
<p>When in doubt, RTFM. It will distill the magic into knowledge and understanding.
Most importantly, leave these bits of knowledge in writing so your code is readable!</p>

  </div><a class="u-url" href="/posts/pic-from-null-programming-concepts-and-tips.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">miccah.io</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">miccah.io</li><li><a class="u-email" href="mailto:contact@miccah.io">contact@miccah.io</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/mcastorina"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">mcastorina</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A website for all my creations, thoughts, and projects. This website will serve as a collection of my interests, ideas, and lessons I have learned over time.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
